<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>/user<\> ðŸ”’</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;background:#b2c7da;font-family:-apple-system,BlinkMacSystemFont}
.app{max-width:420px;margin:0 auto;height:100vh;display:flex;flex-direction:column}
.header{background:#a9bdce;padding:10px;text-align:center;font-weight:600}
.chat{flex:1;padding:10px;overflow-y:auto}
.row{display:flex;margin-bottom:6px}
.me{justify-content:flex-end}
.other{justify-content:flex-start}
.bubble{background:white;padding:8px 12px;border-radius:12px;max-width:70%}
.me .bubble{background:#ffe812}
.input{display:flex;padding:8px;background:#eee}
input{flex:1;padding:8px}
button{margin-left:6px}
</style>
</head>

<body>
<div class="app">
  <div class="header">/user<\> ðŸ”’</div>
  <div class="chat" id="chat"></div>
  <div class="input">
    <input id="msg" placeholder="ë©”ì‹œì§€ ìž…ë ¥">
    <button onclick="send()">ì „ì†¡</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="config.js"></script>

<script>
const roomId = location.hash.substring(1) || "TESTROOM";
const chatRef = firebase.database().ref("rooms/"+roomId+"/chat");
const chat = document.getElementById("chat");

chatRef.limitToLast(100).on("child_added", s=>{
  const d=s.val();
  const row=document.createElement("div");
  row.className="row";
  row.innerHTML=`<div class="bubble">${d.text}</div>`;
  chat.appendChild(row);
  chat.scrollTop=chat.scrollHeight;
});

function send(){
  if(!msg.value) return;
  chatRef.push({text:msg.value});
  msg.value="";
}
</script>
</body>
</html>
